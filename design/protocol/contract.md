# design/protocol/contract.md

## 목적
v0.1.0에서 외부와 맞닿는 최소 인터페이스를 고정한다. CLI 옵션, PPM 출력 형식, 결정성 규칙을 본 문서에 정의하며 구현과 테스트는 본 규약을 기준으로 한다.

## 대상 버전
- 버전: v0.1.0
- 범위: 기본 그라디언트 PPM 생성 CLI

## CLI 규약
- 실행 파일: `raytracer`
- 입력이 없어도 동작하며 기본값으로 렌더링한다.
- 지원 옵션(순서 무관):
  - `--width <정수>`: 이미지 너비(픽셀). 기본값 256. 1 이상 정수만 허용.
  - `--height <정수>`: 이미지 높이(픽셀). 기본값 256. 1 이상 정수만 허용.
  - `--output <경로>`: 출력 대상. 기본값 `-` 이며, `-`는 표준 출력으로 기록한다. 파일 경로가 주어지면 동일 경로에 덮어쓴다.
- 잘못된 옵션이나 값(예: 누락된 파라미터, 1 미만 크기) 입력 시:
  - 표준 오류로 한국어 오류 메시지를 한 줄 출력하고 종료 코드 1을 반환한다.
  - 어떠한 부분 출력도 생성하지 않는다.

## PPM(P3) 출력 규약
- 포맷: ASCII PPM (P3)
- 헤더:
  1. 첫 줄: `P3`
  2. 둘째 줄: `<width> <height>` (공백 하나 구분)
  3. 셋째 줄: `255`
- 본문:
  - 픽셀 순서: 위에서 아래로, 각 행은 왼쪽에서 오른쪽으로 진행한다.
  - 각 픽셀은 `R G B` 세 값으로 이루어진 한 줄로 기록하며, 값 사이에는 공백 하나만 둔다.
  - 모든 줄 끝에는 개행(\n)을 넣는다. 마지막 픽셀 뒤에도 개행을 유지한다.
- 색상 생성 규칙(결정적):
  - 좌표 `(x, y)`에서 `x`는 0..(width-1), `y`는 0..(height-1)로 두며 `y=0`이 상단이다.
  - 정규화 좌표:
    - `width > 1`이면 `u = x / (width - 1)`, `width == 1`이면 `u = 0`.
    - `height > 1`이면 `v = y / (height - 1)`, `height == 1`이면 `v = 0`.
  - 색상 구성:
    - `R = round(255 * u)`
    - `G = round(255 * (1 - v))`
    - `B = 128` (고정)
  - `round`는 표준 반올림(`std::lround`)을 사용하며, 결과는 0..255 범위로 클램프한다.

## 결정성 규칙
- 본 버전에서는 RNG를 사용하지 않는다.
- 동일한 입력(옵션, 해상도)에서는 항상 동일한 PPM 문자열을 생성한다.
- 테스트는 정확한 문자열 비교를 기반으로 한다.

## 출력/파일 정책
- `--output -` 또는 미지정 시 표준 출력으로만 기록한다.
- 파일로 기록 시 ASCII 텍스트만 생성하며 바이너리 파일은 생성하지 않는다.
- 렌더 산출물(.ppm 등)은 저장할 수 있으나 저장한 파일은 커밋 금지이다.

## 종료 코드
- 정상 종료: 0
- 입력 오류 등 사용법 위반: 1
- 파일 기록 실패: 2 (에러 메시지 후 종료)
