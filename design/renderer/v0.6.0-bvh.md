# v0.6.0 BVH/AABB 설계

## 목표
- AABB를 도입해 모든 Hittable이 시간 구간별 경계 상자를 제공하도록 한다.
- 경계 상자를 기반으로 BVH 트리를 구성해 레이 hit 탐색을 가속한다.
- BVH 사용 여부에 따른 hit 성능을 텍스트 숫자로 비교한다.

## AABB 정책
- 자료형: `Aabb(minimum, maximum)`로 최소/최대 좌표를 보관한다.
- 교차: 각 축에 대해 슬래브 방정식을 적용해 `t_min`, `t_max`를 업데이트하며, `t_max <= t_min`이면 미스 처리한다.
- 합성: `SurroundingBox`로 두 박스를 축별 최소/최대 값으로 묶어 상위 노드의 박스를 만든다.

## Hittable 경계 상자 규약
- `Hittable::BoundingBox(time0, time1, box)` 순수 가상 함수를 추가해 모든 도형이 시간 구간별 경계 상자를 제공한다.
- Sphere: 중심 ± 반지름을 사용한 정적 상자를 반환한다.
- MovingSphere: `time0`과 `time1`에서의 중심을 각각 계산한 뒤 두 상자를 `SurroundingBox`로 묶는다.
- HittableList: 모든 하위 객체의 상자를 순회해 누적 SurroundingBox를 계산하며, 비어 있으면 false를 반환한다.

## BVH 빌드/탐색
- 축 선택: 하위 객체들의 합성 박스 대각선 길이를 비교해 가장 긴 축을 기준으로 정렬한다.
- 정렬 후 분할: 객체 개수가 1이면 좌우 노드 동일, 2개면 비교 결과에 따라 좌/우 배치, 그 이상이면 정렬 후 중간에서 재귀 분할한다.
- 박스 확인: 좌/우 노드 모두 BoundingBox 계산에 실패하면 예외를 던져 잘못된 입력을 빠르게 드러낸다.
- Hit: 자신의 박스와 교차하지 않으면 바로 반환하고, 좌/우 노드를 재귀 hit한 뒤 더 가까운 교차를 선택한다. 좌측이 이미 hit된 경우 우측 탐색의 `t_max`를 좌측 `t`로 좁혀 불필요한 탐색을 줄인다.

## 렌더링 적용
- 기존 defocus blur + motion blur 장면을 HittableList로 생성한 뒤 BVH 트리로 감싸서 `RayColor`에 전달한다.
- BVH 트리가 비어 있지 않으면 항상 가속 구조를 사용하고, 비어 있을 때만 리스트를 그대로 사용해 동작을 보존한다.

## 테스트
- 단위: `BvhTest.MatchesHittableListHits`에서 여러 레이를 동일 장면에 쏴서 BVH와 리스트의 hit 여부, `t`, 교차점, 법선, 소재가 모두 일치함을 검증한다.
- 통합: 기존 PPM 스냅샷 테스트를 유지해 BVH 도입 후에도 결정적 출력을 확인한다.

## 성능 비교(텍스트)
- 명령: `./build/bvh_benchmark`
- 환경: 단일 스레드, 고정 시드(2024), 레이 20,000개.
- 결과: 리스트 hit 시간 `16.4845ms`, BVH hit 시간 `3.64637ms`, hit 카운트 차이 `0`으로 동일 결과를 더 빠르게 얻는다.
