# v0.8.0 Cornell Box 설계 노트

## 개요
Quad/Box 프리미티브와 Translate/RotateY 변환을 도입해 Cornell Box 장면을 구성하고, DiffuseLight 발광 재질을 추가해 area light를 구현한다. 기존 BVH 가속과 감마 보정/샘플링 흐름을 유지하면서 배경색을 검정으로 고정한 폐쇄형 장면을 목표로 한다.

## 주요 결정
- **기하**: 일반화된 `Quad(q, u, v)`를 사용해 벽, 천장, 바닥, 뒤쪽 면을 구성하고 여섯 개의 Quad로 `Box(min, max)`를 만든다. Quad는 평면 교차 후 `Dot(planar, u)`와 `Dot(planar, v)`로 내부 여부를 확인하고, 최소 두께 보장을 위해 AABB에 1e-4 패딩을 적용한다.
- **변환**: `Translate`는 레이 원점을 오브젝트 공간으로 이동시킨 뒤 히트 정보를 원복한다. `RotateY`는 입력 레이와 교차 결과를 Y축 회전 행렬로 변환/복원하며, 바운딩 박스는 8개 코너를 회전시켜 계산한다.
- **재질/광원**: `DiffuseLight`가 `Scatter`를 발생시키지 않고 front face에만 `Emitted`를 제공한다. `rayColor`는 `emitted + attenuation * rayColor(scattered, depth-1)`을 사용하며 미히트 시 `(0,0,0)`을 반환한다.
- **카메라**: Cornell Box 관찰을 위해 `lookfrom=(278,278,-800)`, `lookat=(278,278,0)`, `vup=(0,1,0)`, FOV 40°, aperture 0.0을 고정한다.
- **장면 배치**:
  - 벽 재질: green (x=555), red (x=0), white 천장/바닥/뒤쪽.
  - 광원: `Quad(q=(213,554,227), u=(130,0,0), v=(0,0,105))`로 법선이 -y를 향하도록 배치.
  - 박스: `(0,0,0)-(165,165,165)`를 RotateY(-18°)+Translate(130,0,65), `(0,0,0)-(165,330,165)`를 RotateY(15°)+Translate(265,0,295).
- **결정성**: `std::mt19937` 한 인스턴스가 픽셀 샘플과 재질 산란에 직렬로 소비되며 시드는 CLI의 `--seed`로 지정한다.

## 테스트
- 단위: `Quad` 교차 시 UV와 법선이 올바른지, 변환 후 위치가 예상대로 이동하는지 검증(`tests/unit/quad_test.cpp`).
- 통합: 4x4 Cornell mini 씬을 고정 시드로 렌더링한 PPM 문자열을 비교하고, 동일 시드 반복 호출 시 동일 문자열이 생성되는지 확인한다(`tests/integration/ppm_integration_test.cpp`).
