# v0.9.0 Volume 설계 노트

## 개요
Cornell Box 내부에 균일 밀도(ConstantMedium) 볼륨을 두어 Cornell smoke 장면을 결정적으로 렌더링한다. 모든 Hittable에 RNG를 전달해 볼륨 산란 거리 샘플링이 카메라·재질 난수와 동일한 순서로 소비되도록 바꿨으며, 기존 Quad/Box/BVH 구조 위에 Isotropic 위상 함수를 추가했다.

## 설계 결정
- **RNG 전달:** 볼륨 내부 산란 거리 샘플링이 필요해 `Hittable::Hit` 시그니처에 `std::mt19937&`를 추가했다. BVH/Transform/Quad/Sphere/Box/HittableList 모두 동일 시그니처를 따르며, BVH 트리 탐색 순서로 RNG가 직렬 소비된다.
- **ConstantMedium:**
  - 경계 Hittable을 두 번(hit 구간) 조회한 뒤 `distance = -ln(rand01)/density`로 산란 지점을 샘플링한다. `rand01`은 `1e-12`로 하한을 둬 `log(0)`을 방지한다.
  - `neg_inv_density`를 미리 보관해 곱셈 한 번으로 거리 계산을 단순화했다.
  - 산란 지점의 법선은 위상 함수와 무관하므로 `(1,0,0)`으로 고정하고 `front_face=true`로 처리한다. 감쇠는 Isotropic 소재가 담당한다.
- **Isotropic 위상 함수:** 단색 또는 텍스처 입력을 받아 단위 구 내부 임의 방향으로 산란시키며, 감쇠를 텍스처 값으로 지정한다.
- **Cornell smoke 배치:**
  - 벽/바닥/천장/뒤쪽 면과 광원 Quad는 v0.8.0 Cornell Box와 동일하게 유지한다.
  - 두 상자를 경계로 ConstantMedium을 적용한다. 첫 번째는 회전(-18°)+이동(130,0,65) 후 `density=0.01`, 색상 `(0,0,0)`이며, 두 번째는 회전(15°)+이동(265,0,295) 후 `density=0.01`, 색상 `(1,1,1)`을 사용한다. 경계 Box는 씬에 직접 추가하지 않고 볼륨 래퍼를 통해서만 사용한다.
- **카메라/샘플링:** v0.8.0과 동일한 카메라(lookfrom 278,278,-800 등)와 감마 보정 정책을 유지한다. 픽셀 샘플링 → 볼륨 샘플링 → 재질 산란 순서로 RNG가 소모된다.

## 테스트
- **통합:** 4x4 해상도, spp=4, seed=3으로 Cornell smoke를 렌더링해 PPM 문자열을 고정 비교한다(`tests/integration/ppm_integration_test.cpp`). 동일 시드 반복 시 동일 문자열이 생성되는지도 검증한다.
- **유닛:** Sphere/Quad/BVH hit 테스트에 RNG 인자를 추가해 새 인터페이스를 검증하고 기존 기하 계산이 유지되는지 확인한다.
